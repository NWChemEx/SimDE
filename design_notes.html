

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Design Notes &mdash; SimDE 1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> SimDE
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="structure.html">Structure of the SimDE Repo</a></li>
<li class="toctree-l1"><a class="reference external" href="https://nwchemex-project.github.io/SimDE/simde_cxx_api/index.html">C++ API</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SimDE</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Design Notes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/design_notes.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="design-notes">
<h1>Design Notes<a class="headerlink" href="#design-notes" title="Permalink to this heading">¶</a></h1>
<section id="tensorrepresentation">
<h2>TensorRepresentation<a class="headerlink" href="#tensorrepresentation" title="Permalink to this heading">¶</a></h2>
<p>To convert an operator into a tensor in she some basis set the target API is:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Two-center</span>
<span class="n">Tensor</span><span class="w"> </span><span class="nf">TensorRepresentation</span><span class="p">(</span><span class="n">bra</span><span class="p">,</span><span class="w"> </span><span class="k">operator</span><span class="p">,</span><span class="w"> </span><span class="n">ket</span><span class="p">);</span>

<span class="c1">// Three-center</span>
<span class="n">Tensor</span><span class="w"> </span><span class="nf">TensorRepresentation</span><span class="p">(</span><span class="n">bra</span><span class="p">,</span><span class="w"> </span><span class="k">operator</span><span class="p">,</span><span class="w"> </span><span class="n">ket1</span><span class="p">,</span><span class="w"> </span><span class="n">ket2</span><span class="p">);</span>
<span class="c1">// or</span>
<span class="n">Tensor</span><span class="w"> </span><span class="nf">TensorRepresentation</span><span class="p">(</span><span class="n">bra1</span><span class="p">,</span><span class="w"> </span><span class="n">bra2</span><span class="p">,</span><span class="w"> </span><span class="k">operator</span><span class="p">,</span><span class="w"> </span><span class="n">ket</span><span class="p">);</span>

<span class="c1">// Four-center</span>
<span class="n">Tensor</span><span class="w"> </span><span class="nf">TensorRepresentation</span><span class="p">(</span><span class="n">bra1</span><span class="p">,</span><span class="w"> </span><span class="n">bra2</span><span class="p">,</span><span class="w"> </span><span class="k">operator</span><span class="p">,</span><span class="w"> </span><span class="n">ket1</span><span class="p">,</span><span class="w"> </span><span class="n">ket2</span><span class="p">);</span>
</pre></div>
</div>
<p>Focusing on only the AO basis set for the moment we have <code class="docutils literal notranslate"><span class="pre">AOSpace&lt;T&gt;</span></code>
instances and <code class="docutils literal notranslate"><span class="pre">SparseAOSpace&lt;T&gt;</span></code> instances. For a four-center integral like
<code class="docutils literal notranslate"><span class="pre">I(&quot;mu,nu;lambda,sigma&quot;)</span></code> we need to take two <code class="docutils literal notranslate"><span class="pre">AOSpace&lt;T&gt;</span></code> and
two <code class="docutils literal notranslate"><span class="pre">SparseAOSpace&lt;T&gt;</span></code> instances (note that which two modes are dependent
and which two are independent is determined by the types of the AO spaces
provided). This gives us <span class="math notranslate nohighlight">\(2^N\)</span> overloads for an <span class="math notranslate nohighlight">\(N\)</span>-center integral.
If we add derived spaces into the mix (so we can do transfomrations) this
becomes <span class="math notranslate nohighlight">\(4^N\)</span> overloads (there’s normal and sparse versions of derived
space too). This doesn’t even take precision (i.e. double vs float) into account.
Asking module developers to handle all of these overloads is infeasible. Instead
we distinguish between the following scenarios:</p>
<ol class="arabic simple">
<li><p>All <code class="docutils literal notranslate"><span class="pre">type::ao_space&lt;T&gt;</span></code></p>
<ul class="simple">
<li><p>This is the base case which maps directly to a call to an integral library</p></li>
<li><p>Handled by property type <code class="docutils literal notranslate"><span class="pre">AOTensorRepresentation</span></code></p></li>
</ul>
</li>
<li><p>Mix of <code class="docutils literal notranslate"><span class="pre">type::sparse_ao_space&lt;T&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">type::ao_space&lt;T&gt;</span></code> instances</p>
<ul class="simple">
<li><p>This is what happens when we use ToTs</p></li>
<li><p>The module will likely dispatch to an “all <code class="docutils literal notranslate"><span class="pre">AOSpace&lt;T&gt;</span></code> submodule and
then fill in the ToT appropriately</p></li>
<li><p>Handled by property type <code class="docutils literal notranslate"><span class="pre">GeneralAOTensorRepresentation</span></code></p></li>
</ul>
</li>
<li><p>One or more <code class="docutils literal notranslate"><span class="pre">type::derived_spaceD</span></code></p>
<ul class="simple">
<li><p>Will probably dispatch to scenario 1, then do the transform</p></li>
<li></li>
</ul>
</li>
<li><p>At least one <code class="docutils literal notranslate"><span class="pre">type::ind_derived_spaceD</span></code> or <code class="docutils literal notranslate"><span class="pre">type::dep_derived_spaceD</span></code></p>
<ul class="simple">
<li><p>Will probably dispatch to scenario 2, then do the transform</p></li>
</ul>
</li>
</ol>
<p>For scenario 1 it’s pretty easy to have the API we want and we define the
property type’s API:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">OperatorType</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<span class="n">type</span><span class="o">::</span><span class="n">tensor</span><span class="w"> </span><span class="n">AOTensorRepresentation</span><span class="p">(</span><span class="n">type</span><span class="o">::</span><span class="n">ao_space</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">OperatorType</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">type</span><span class="o">::</span><span class="n">ao_space</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>For scenarios 2-4 we provide a free function (for API symmetry the free function
also works with scenario 1):</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span><span class="n">Args</span><span class="o">&gt;</span>
<span class="k">auto</span><span class="w"> </span><span class="n">TensorRepresentation</span><span class="p">(</span><span class="n">sde</span><span class="o">::</span><span class="n">Module</span><span class="o">&amp;</span><span class="w"> </span><span class="n">mod</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="o">&amp;&amp;</span><span class="p">...</span><span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<p>which is used like:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Two center call</span>
<span class="k">auto</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TensorRepresentation</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span><span class="w"> </span><span class="n">bra</span><span class="p">,</span><span class="w"> </span><span class="n">op</span><span class="p">,</span><span class="w"> </span><span class="n">ket</span><span class="p">);</span>

<span class="c1">// Four center call</span>
<span class="k">auto</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TensorRepresentation</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span><span class="w"> </span><span class="n">bra1</span><span class="p">,</span><span class="w"> </span><span class="n">bra2</span><span class="p">,</span><span class="w"> </span><span class="n">op</span><span class="p">,</span><span class="w"> </span><span class="n">ket1</span><span class="p">,</span><span class="w"> </span><span class="n">ket2</span><span class="p">);</span>
</pre></div>
</div>
<p>This function takes a module to call, the bra(s), the operator, and the ket(s).
Internally it then packages the arguments based on type (<code class="docutils literal notranslate"><span class="pre">type::ao_space&lt;T&gt;</span></code>
vs <code class="docutils literal notranslate"><span class="pre">type::derived_spaceD</span></code> vs…), calls the module, and returns the result.</p>
<p>The actual property type API for scenarios 2 is:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="n">typeanme</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span>
<span class="k">using</span><span class="w"> </span><span class="n">sparse_map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">::</span><span class="n">sparse_ao_space</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">;</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<span class="k">using</span><span class="w"> </span><span class="n">dense_map</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">::</span><span class="n">ao_space</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">;</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">OperatorType</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">ElementType</span><span class="o">&gt;</span>
<span class="n">type</span><span class="o">::</span><span class="n">tensor_of_tensors</span>
<span class="n">GeneralAOTensorRepresentation</span><span class="p">(</span><span class="n">sparse_map</span><span class="o">&lt;</span><span class="n">ElementType</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">                              </span><span class="n">dense_map</span><span class="o">&lt;</span><span class="n">ElementType</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">                              </span><span class="n">OperatorType</span><span class="p">);</span>
</pre></div>
</div>
<p>where the maps map from tensor mode to AO spaces, e.g. sparse_map[1] is the
AO space for the 1-st mode of the output tensor (if <cite>sparse_map.count(1) == 0</cite>
then mode 1 isn’t sparse…). The property type API for scenarios 3 and 4 are
similar. For scenario 3:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="n">typeanme</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span>
<span class="k">using</span><span class="w"> </span><span class="n">ao_space_map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">::</span><span class="n">ao_space</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">;</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<span class="k">using</span><span class="w"> </span><span class="n">derived_map</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">::</span><span class="n">derived_space</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">;</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">OperatorType</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">ElementType</span><span class="o">&gt;</span>
<span class="n">type</span><span class="o">::</span><span class="n">tensor</span><span class="w"> </span><span class="n">TransformedTensorRepresentation</span><span class="p">(</span><span class="n">ao_space_map</span><span class="o">&lt;</span><span class="n">ElementType</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">                                             </span><span class="n">derived_map</span><span class="o">&lt;</span><span class="n">ElementType</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">                                             </span><span class="n">OperatorType</span><span class="p">);</span>
</pre></div>
</div>
<p>and for scenario 4:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="n">typeanme</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span>
<span class="k">using</span><span class="w"> </span><span class="n">ao_space_map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">::</span><span class="n">ao_space</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">;</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<span class="k">using</span><span class="w"> </span><span class="n">sparse_ao_map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">::</span><span class="n">sparse_ao_space</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">;</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<span class="k">using</span><span class="w"> </span><span class="n">ind_derived_map</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">::</span><span class="n">ind_derived_space</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">;</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<span class="k">using</span><span class="w"> </span><span class="n">dep_derived_map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">::</span><span class="n">dep_derived_space</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">;</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">OperatorType</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">ElementType</span><span class="o">&gt;</span>
<span class="n">type</span><span class="o">::</span><span class="n">tensor</span><span class="w"> </span><span class="n">GeneralTransformedTensorRepresentation</span><span class="p">(</span><span class="n">ao_space_map</span><span class="o">&lt;</span><span class="n">ElementType</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">                                             </span><span class="n">sparse_ao_space</span><span class="o">&lt;</span><span class="n">ElementType</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">                                             </span><span class="n">ind_derived_map</span><span class="o">&lt;</span><span class="n">ElementType</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">                                             </span><span class="n">dep_derived_map</span><span class="o">&lt;</span><span class="n">ElementType</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">                                             </span><span class="n">OperatorType</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, NWChemEx Team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>